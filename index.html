<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BettaAI - Your Personal AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --sidebar-width: 280px; }
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; overflow: hidden; }
        .chat-container { height: 100dvh; display: flex; flex-direction: column; }
        .sidebar-transition { transition: transform 0.3s ease-in-out; }
        .markdown-body pre { background: #1e1e1e; color: #fff; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin: 1rem 0; }
        .markdown-body code { font-family: monospace; background: rgba(0,0,0,0.1); padding: 0.2rem 0.4rem; border-radius: 4px; }
        .dark .markdown-body code { background: rgba(255,255,255,0.1); }
        .message-bubble { max-width: 85%; word-wrap: break-word; }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: #374151; }
        #loading { position: fixed; inset: 0; background: white; display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .dark #loading { background: #111827; color: white; }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        gemini: {
                            light: '#f0f4f9',
                            dark: '#131314',
                            sidebar: '#1e1f20'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-white dark:bg-gemini-dark text-gray-900 dark:text-gray-100">

    <div id="loading">
        <div class="flex flex-col items-center gap-4">
            <div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="font-medium">Initializing AI Interface...</p>
        </div>
    </div>

    <div class="flex h-screen w-full overflow-hidden">
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-[280px] bg-gemini-light dark:bg-[#1e1f20] transform -translate-x-full lg:translate-x-0 sidebar-transition flex flex-col border-r border-gray-200 dark:border-gray-800">
            <div class="p-4 flex flex-col h-full">
                <button onclick="createNewChat()" class="flex items-center gap-3 px-4 py-3 bg-gray-200 dark:bg-gray-700 hover:opacity-80 rounded-full transition-all mb-8">
                    <span class="text-xl">+</span>
                    <span class="font-medium text-sm">New Chat</span>
                </button>

                <div id="chat-history" class="flex-1 overflow-y-auto space-y-2">
                    </div>

                <div class="mt-auto pt-4 border-t border-gray-300 dark:border-gray-700">
                    <button onclick="toggleSettings()" class="flex items-center gap-3 w-full p-3 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg transition">
                        <span>‚öôÔ∏è</span><span>Settings</span>
                    </button>
                    <button onclick="toggleDarkMode()" class="flex items-center gap-3 w-full p-3 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-lg transition">
                        <span id="theme-icon">üåô</span><span id="theme-text">Dark Mode</span>
                    </button>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative w-full lg:ml-0 h-full overflow-hidden">
            <header class="h-16 flex items-center justify-between px-4 border-b border-gray-100 dark:border-gray-800">
                <div class="flex items-center gap-4">
                    <button onclick="toggleSidebar()" class="lg:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg">
                        ‚ò∞
                    </button>
                    <h1 class="text-xl font-semibold bg-gradient-to-r from-blue-600 to-purple-500 bg-clip-text text-transparent">Gemini AI</h1>
                </div>
                <div id="current-model-badge" class="text-xs bg-gray-100 dark:bg-gray-800 px-3 py-1 rounded-full text-gray-500">
                    Model: deepseek-r1
                </div>
            </header>

            <div id="chat-window" class="flex-1 overflow-y-auto p-4 md:p-8 space-y-6 pb-32">
                <div id="empty-state" class="h-full flex flex-col items-center justify-center text-center space-y-4 opacity-50">
                    <div class="text-5xl">‚ú®</div>
                    <h2 class="text-2xl font-medium">How can I help you today?</h2>
                </div>
                <div id="messages-container" class="max-w-3xl mx-auto space-y-8"></div>
            </div>

            <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-white dark:from-gemini-dark via-white dark:via-gemini-dark to-transparent">
                <div class="max-w-3xl mx-auto relative flex items-end gap-2 bg-gray-100 dark:bg-[#28292a] rounded-2xl p-2 focus-within:ring-2 ring-blue-500 transition-all">
                    <textarea 
                        id="user-input"
                        rows="1"
                        placeholder="Enter a prompt here"
                        class="w-full bg-transparent border-none focus:ring-0 p-3 max-h-48 resize-none text-gray-800 dark:text-gray-100"
                        oninput="this.style.height = '';this.style.height = this.scrollHeight + 'px'"
                    ></textarea>
                    <button id="send-btn" onclick="handleSendMessage()" class="p-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition disabled:opacity-50">
                        <svg viewBox="0 0 24 24" class="w-5 h-5 fill-current"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>
                    </button>
                </div>
                <p class="text-[10px] text-center mt-2 text-gray-400">Gemini may display inaccurate info, including about people, so double-check its responses.</p>
            </div>
        </main>
    </div>

    <div id="settings-modal" class="fixed inset-0 z-[60] hidden flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm">
        <div class="bg-white dark:bg-gray-900 w-full max-w-md rounded-2xl p-6 shadow-2xl">
            <h2 class="text-xl font-bold mb-4">API Settings</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">OpenRouter API Key</label>
                    <input type="password" id="api-key-input" class="w-full p-3 rounded-lg border dark:bg-gray-800 dark:border-gray-700" placeholder="sk-or-...">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Model ID</label>
                    <input type="text" id="model-input" class="w-full p-3 rounded-lg border dark:bg-gray-800 dark:border-gray-700" placeholder="deepseek/deepseek-r1:free">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">System Prompt</label>
                    <textarea id="system-prompt-input" rows="3" class="w-full p-3 rounded-lg border dark:bg-gray-800 dark:border-gray-700" placeholder="You are a helpful assistant..."></textarea>
                </div>
            </div>
            <div class="mt-6 flex justify-end gap-3">
                <button onclick="toggleSettings()" class="px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg">Cancel</button>
                <button onclick="saveSettings()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Save Changes</button>
            </div>
        </div>
    </div>

    <script>
        // --- CONFIG & STATE ---
        let state = {
            chats: JSON.parse(localStorage.getItem('chats') || '[]'),
            currentChatId: null,
            settings: JSON.parse(localStorage.getItem('settings') || JSON.stringify({
                apiKey: '',
                model: 'deepseek/deepseek-r1:free',
                systemPrompt: 'You are a helpful AI assistant.',
                darkMode: false
            }))
        };

        const elements = {
            chatWindow: document.getElementById('chat-window'),
            messagesContainer: document.getElementById('messages-container'),
            userInput: document.getElementById('user-input'),
            sidebar: document.getElementById('sidebar'),
            loading: document.getElementById('loading'),
            historyList: document.getElementById('chat-history'),
            settingsModal: document.getElementById('settings-modal'),
            emptyState: document.getElementById('empty-state')
        };

        // --- INITIALIZATION ---
        function init() {
            // Apply Dark Mode
            if (state.settings.darkMode) {
                document.documentElement.classList.add('dark');
                updateThemeUI(true);
            }

            // Load inputs from settings
            document.getElementById('api-key-input').value = state.settings.apiKey;
            document.getElementById('model-input').value = state.settings.model;
            document.getElementById('system-prompt-input').value = state.settings.systemPrompt;
            document.getElementById('current-model-badge').innerText = `Model: ${state.settings.model.split('/').pop()}`;

            renderHistory();
            
            // Hide loader
            setTimeout(() => {
                elements.loading.style.opacity = '0';
                setTimeout(() => elements.loading.style.display = 'none', 300);
            }, 500);

            // Event Listeners
            elements.userInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });
        }

        // --- CORE CHAT LOGIC ---
        async function handleSendMessage() {
            const text = elements.userInput.value.trim();
            if (!text || !state.settings.apiKey) {
                if(!state.settings.apiKey) alert("Please set your OpenRouter API Key in settings first.");
                return;
            }

            // Create new chat if none exists
            if (!state.currentChatId) {
                const newChat = {
                    id: Date.now().toString(),
                    title: text.substring(0, 30) + '...',
                    messages: [],
                    systemPrompt: state.settings.systemPrompt
                };
                state.chats.unshift(newChat);
                state.currentChatId = newChat.id;
            }

            const chat = state.chats.find(c => c.id === state.currentChatId);
            
            // Add User Message
            const userMsg = { role: 'user', content: text };
            chat.messages.push(userMsg);
            
            elements.userInput.value = '';
            elements.userInput.style.height = 'auto';
            renderMessages();
            saveState();

            // Prepare AI message placeholder
            const aiMsgId = 'msg-' + Date.now();
            const aiMsg = { role: 'assistant', content: '', id: aiMsgId };
            chat.messages.push(aiMsg);
            renderMessages();
            
            const messageElement = document.getElementById(aiMsgId);
            const contentDiv = messageElement.querySelector('.markdown-body');

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${state.settings.apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.href,
                    },
                    body: JSON.stringify({
                        model: state.settings.model,
                        messages: [
                            { role: 'system', content: chat.systemPrompt },
                            ...chat.messages.slice(0, -1).map(m => ({ role: m.role, content: m.content }))
                        ],
                        stream: true
                    })
                });

                if (!response.ok) throw new Error(await response.text());

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let fullContent = "";

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    const chunk = decoder.decode(value);
                    const lines = chunk.split('\n').filter(line => line.trim() !== '');

                    for (const line of lines) {
                        if (line.includes('data: [DONE]')) continue;
                        if (line.startsWith('data: ')) {
                            try {
                                const data = JSON.parse(line.replace('data: ', ''));
                                const token = data.choices[0]?.delta?.content || "";
                                fullContent += token;
                                aiMsg.content = fullContent;
                                contentDiv.innerHTML = marked.parse(fullContent);
                                elements.chatWindow.scrollTo(0, elements.chatWindow.scrollHeight);
                            } catch (e) { console.error("Error parsing stream", e); }
                        }
                    }
                }
                saveState();
                renderHistory();

            } catch (error) {
                console.error(error);
                aiMsg.content = `‚ö†Ô∏è Error: ${error.message}`;
                contentDiv.innerHTML = `<span class="text-red-500">${aiMsg.content}</span>`;
            }
        }

        // --- UI RENDERING ---
        function renderMessages() {
            const chat = state.chats.find(c => c.id === state.currentChatId);
            if (!chat) {
                elements.emptyState.classList.remove('hidden');
                elements.messagesContainer.innerHTML = '';
                return;
            }

            elements.emptyState.classList.add('hidden');
            elements.messagesContainer.innerHTML = chat.messages.map(m => `
                <div class="flex ${m.role === 'user' ? 'justify-end' : 'justify-start'} animate-in fade-in duration-300">
                    <div id="${m.id || ''}" class="message-bubble p-4 rounded-2xl ${
                        m.role === 'user' 
                        ? 'bg-blue-600 text-white rounded-tr-none' 
                        : 'bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-100 rounded-tl-none'
                    }">
                        <div class="text-xs mb-1 opacity-50 font-bold uppercase tracking-wider">
                            ${m.role === 'user' ? 'You' : 'AI'}
                        </div>
                        <div class="markdown-body prose dark:prose-invert max-w-none">
                            ${marked.parse(m.content || '...')}
                        </div>
                    </div>
                </div>
            `).join('');
            
            elements.chatWindow.scrollTo(0, elements.chatWindow.scrollHeight);
        }

        function renderHistory() {
            elements.historyList.innerHTML = state.chats.map(chat => `
                <div onclick="loadChat('${chat.id}')" class="group flex items-center justify-between p-3 rounded-xl cursor-pointer transition ${state.currentChatId === chat.id ? 'bg-blue-100 dark:bg-blue-900/30' : 'hover:bg-gray-200 dark:hover:bg-gray-800'}">
                    <span class="truncate text-sm pr-2">${chat.title}</span>
                    <button onclick="event.stopPropagation(); deleteChat('${chat.id}')" class="opacity-0 group-hover:opacity-100 p-1 hover:text-red-500 transition">
                        üóëÔ∏è
                    </button>
                </div>
            `).join('');
        }

        // --- ACTIONS ---
        function createNewChat() {
            state.currentChatId = null;
            renderMessages();
            renderHistory();
            if(window.innerWidth < 1024) toggleSidebar();
        }

        function loadChat(id) {
            state.currentChatId = id;
            renderMessages();
            renderHistory();
            if(window.innerWidth < 1024) toggleSidebar();
        }

        function deleteChat(id) {
            state.chats = state.chats.filter(c => c.id !== id);
            if (state.currentChatId === id) state.currentChatId = null;
            saveState();
            renderHistory();
            renderMessages();
        }

        function toggleSidebar() {
            elements.sidebar.classList.toggle('-translate-x-full');
        }

        function toggleSettings() {
            elements.settingsModal.classList.toggle('hidden');
        }

        function saveSettings() {
            state.settings.apiKey = document.getElementById('api-key-input').value;
            state.settings.model = document.getElementById('model-input').value || 'deepseek/deepseek-r1:free';
            state.settings.systemPrompt = document.getElementById('system-prompt-input').value;
            
            document.getElementById('current-model-badge').innerText = `Model: ${state.settings.model.split('/').pop()}`;
            saveState();
            toggleSettings();
        }

        function toggleDarkMode() {
            state.settings.darkMode = !state.settings.darkMode;
            document.documentElement.classList.toggle('dark');
            updateThemeUI(state.settings.darkMode);
            saveState();
        }

        function updateThemeUI(isDark) {
            document.getElementById('theme-icon').innerText = isDark ? '‚òÄÔ∏è' : 'üåô';
            document.getElementById('theme-text').innerText = isDark ? 'Light Mode' : 'Dark Mode';
        }

        function saveState() {
            localStorage.setItem('chats', JSON.stringify(state.chats));
            localStorage.setItem('settings', JSON.stringify(state.settings));
        }

        // Run Init
        init();
    </script>
</body>
  </html>
  
